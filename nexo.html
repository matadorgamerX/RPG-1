<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexo do Paradoxo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
            background-image: radial-gradient(circle at top right, rgba(12, 74, 110, 0.5), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(109, 40, 217, 0.3), transparent 50%);
            background-attachment: fixed;
        }
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        .card {
            background-color: rgba(31, 41, 55, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        .card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            border-color: #a78bfa;
        }
        .card-locked {
            position: relative;
            overflow: hidden;
        }
        .card-locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(2px);
            z-index: 1;
        }
        .card-locked .card-content {
            z-index: 2;
            position: relative;
        }
        .btn-primary {
            background-color: #8b5cf6;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #7c3aed;
        }
        .modal {
            background-color: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(10px);
        }
        .log-message {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="./firebase-config.js"></script>
    <script>
      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
      const auth = firebase.auth();
    </script>
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="container mx-auto max-w-7xl">

        <!-- Cabeçalho -->
        <header class="text-center mb-8 flex justify-between items-center">
            <a href="main.html" class="btn-primary text-white font-bold py-2 px-4 rounded-lg">&larr; Voltar ao Portal</a>
            <div>
                <h1 class="text-4xl sm:text-5xl font-bold font-cinzel text-violet-300 tracking-wider">Nexo do Paradoxo</h1>
                <p class="text-lg text-gray-400 mt-2">Um refúgio forjado entre a Ordem e o Caos.</p>
            </div>
            <button id="admin-login-button" class="btn-primary text-white font-bold py-2 px-4 rounded-lg">Admin</button>
        </header>

        <!-- Grid de Cômodos -->
        <main id="comodos-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Os cards dos cômodos serão inseridos aqui pelo JavaScript -->
        </main>

        <!-- Log de Atividades -->
        <div class="mt-12">
            <h2 class="text-2xl font-cinzel text-center mb-4">Registro de Atividades</h2>
            <div id="log-container" class="bg-gray-900/60 border border-gray-700 rounded-lg p-4 h-48 overflow-y-auto space-y-2">
                <p class="text-gray-400 italic">Bem-vindo ao Nexo. Suas ações serão registradas aqui.</p>
            </div>
        </div>

    </div>

    <!-- Modal de Senha -->
    <div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 hidden z-50">
        <div class="modal border border-violet-500 rounded-lg shadow-2xl w-full max-w-sm">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-4 text-violet-300">Acesso de Administrador</h3>
                <div>
                    <label for="passwordInput" class="block text-sm font-medium text-gray-300 mb-1">Palavra-Passe</label>
                    <input type="password" id="passwordInput" class="w-full bg-gray-700 border border-violet-500 text-white rounded-lg p-2.5 focus:ring-violet-500 focus:border-violet-500">
                    <p id="passwordError" class="text-red-400 text-sm mt-2 hidden">Palavra-passe incorreta.</p>
                </div>
                <div class="mt-6 flex justify-end gap-4">
                    <button id="cancelPasswordButton" class="btn-secondary text-white font-bold py-2 px-4 rounded-lg">Cancelar</button>
                    <button id="submitPasswordButton" class="btn-primary text-white font-bold py-2 px-4 rounded-lg">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ações -->
    <div id="modal-acoes" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/70"></div>
        <div class="modal border border-violet-500 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col relative z-10">
            <div class="p-6 border-b border-gray-700">
                <h2 id="modal-title" class="text-3xl font-cinzel text-violet-300">Nome do Cômodo</h2>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <!-- Ações serão inseridas aqui -->
            </div>
            <div class="p-4 bg-gray-800/50 border-t border-gray-700 text-right rounded-b-lg">
                <button id="modal-close-btn" class="btn-primary text-white font-bold py-2 px-6 rounded-lg">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // --- ESTADO INICIAL DO JOGO ---
        const gameState = {
            comodos: [
                { id: 'forja', nome: 'Forja', disponivel: true, custo: 0, descricao: "O coração pulsante do Nexo, onde o metal bruto é domado pelo fogo e pela vontade.", acoes: [
                    { nome: 'Forjar Equipamento Padrão', desc: 'Crie armas e armaduras comuns.' },
                    { nome: 'Reparar Itens', desc: 'Conserte equipamentos danificados.' },
                    { nome: 'Forjar com Metais de Kuar-Tor', desc: 'Use minérios instáveis para criar equipamentos superiores.' },
                    { nome: 'Imbuir com Ordem', desc: 'Adicione runas de Bella para bônus de precisão ou defesa.' },
                    { nome: 'Imbuir com Caos', desc: 'Forje uma arma no fogo de Furiam para dano massivo com riscos.' }
                ]},
                { id: 'cozinha', nome: 'Cozinha', disponivel: true, custo: 0, descricao: "Um caos organizado onde ingredientes exóticos se tornam refeições que fortalecem o corpo e a alma.", acoes: [
                    { nome: 'Refeição Revigorante', desc: 'Recupere PV e remova penalidades menores.' },
                    { nome: 'Aprender uma Receita', desc: 'Aprenda a preparar um prato com bônus temporário.' },
                    { nome: 'Identificar Ingredientes', desc: 'Descubra as propriedades de um ingrediente exótico.' },
                    { nome: 'Preparar Rações de Viagem', desc: 'Crie rações que protegem contra a corrupção do Vazio.' }
                ]},
                { id: 'biblioteca', nome: 'Biblioteca', disponivel: true, custo: 0, descricao: "Um arquivo de conhecimento paradoxal, contendo tanto a sabedoria da Ordem quanto os segredos da loucura do Caos.", acoes: [
                    { nome: 'Pesquisar um Tópico', desc: 'Estude sobre criaturas, lugares ou a história de Kuar-Tor.' },
                    { nome: 'Decifrar um Tomo Caótico', desc: 'Tente ler um dos livros proibidos. Grande risco, grande recompensa.' },
                    { nome: 'Pedir um Conselho a Rayluum', desc: 'Obtenha uma pista enigmática da bibliotecária cega.' },
                    { nome: 'Copiar um Pergaminho', desc: 'Faça uma cópia de um feitiço ou ritual.' }
                ]},
                { id: 'nucleo', nome: 'O Núcleo', disponivel: true, custo: 0, descricao: "O cérebro senciente do Nexo, uma fusão de lógica e impulso que guia os aventureiros.", acoes: [
                    { nome: 'Relatório da Missão', desc: 'Receba um briefing detalhado sobre um objetivo.' },
                    { nome: 'Analisar um Artefato', desc: 'Identifique a função de um item de origem desconhecida.' },
                    { nome: 'Rodar uma Simulação de Combate', desc: 'Teste suas táticas contra um inimigo virtual.' },
                    { nome: 'Conversar com as Personalidades', desc: 'Fale com "Bella" ou "Furiam" para obter diferentes perspectivas.' }
                ]},
                { id: 'laboratorio_magias', nome: 'Laboratório das Magias', disponivel: false, custo: 1000, descricao: "Um salão de poder arcano onde a magia da Ordem pode ser estudada e a magia selvagem do Caos, observada.", acoes: [
                    { nome: 'Aprender um Feitiço', desc: 'Estude os círculos de poder para aprender um novo feitiço da Ordem.' },
                    { nome: 'Canalizar Magia Selvagem', desc: 'Medite perto da fenda de caos para aprender um feitiço caótico.' },
                    { nome: 'Encantar um Item', desc: 'Imbua um item mundano com uma propriedade mágica simples.' }
                ]},
                { id: 'laboratorio_engenheiros', nome: 'Laboratórios dos Engenheiros', disponivel: false, custo: 1500, descricao: "Bancadas repletas de protótipos instáveis, onde a tecnologia encontra o imprevisível.", acoes: [
                    { nome: 'Criar Gadgets', desc: 'Construa granadas, sensores ou melhorias para armas.' },
                    { nome: 'Construir um Autômato', desc: 'Inicie um projeto de longo prazo para um companheiro robótico.' },
                    { nome: 'Melhorar um Autômato', desc: 'Instale novas peças ou software em um autômato.' },
                    { nome: 'Hackear um Dispositivo', desc: 'Tente acessar um dispositivo tecnológico recuperado.' }
                ]},
                { id: 'laboratorio_alquimia', nome: 'Laboratório de Alquimia', disponivel: false, custo: 2000, descricao: "Aqui, a ciência da transformação cria tanto venenos devastadores quanto curas milagrosas.", acoes: [
                    { nome: 'Criar Poções e Venenos', desc: 'Fabrique elixires, poções de buff, ácidos ou toxinas.' },
                    { nome: 'Experimentar com Ingredientes', desc: 'Misture ingredientes sem receita para resultados imprevisíveis.' },
                    { nome: 'Aprender com Miranda', desc: 'Aprenda uma nova e rara receita com a mestre alquimista.' }
                ]},
                { id: 'minerio', nome: 'Minério', disponivel: false, custo: 2000, descricao: "Uma câmara para processar as rochas instáveis de Kuar-Tor, transformando perigo bruto em material útil.", acoes: [
                    { nome: 'Processar Minério Bruto', desc: 'Refine rochas instáveis para obter metais de alta qualidade.' },
                    { nome: 'Procurar por Gemas Raras', desc: 'Examine os minérios em busca de cristais com propriedades especiais.' }
                ]},
                { id: 'estufa', nome: 'Estufa', disponivel: false, custo: 2000, descricao: "Um jardim impossível onde a flora de Kuar-Tor é cultivada, um ecossistema em constante fluxo.", acoes: [
                    { nome: 'Coletar Ingredientes', desc: 'Colha plantas com propriedades alquímicas ou culinárias.' },
                    { nome: 'Estudar um Espécime', desc: 'Entenda o ciclo de vida de uma planta caótica para otimizar a colheita.' }
                ]},
                { id: 'enfermaria', nome: 'Enfermaria', disponivel: false, custo: 3000, descricao: "Um santuário de paz e cura, onde as feridas do corpo e da alma, manchadas pelo Vazio, são tratadas.", acoes: [
                    { nome: 'Curar Ferimentos Graves', desc: 'Trate feridas que poções comuns não podem curar.' },
                    { nome: 'Tratar Corrupção do Vazio', desc: 'Realize um procedimento complexo para purificar a alma.' },
                    { nome: 'Remover Maldições e Doenças', desc: 'Cure aflições mágicas com ciência e rituais.' }
                ]},
                { id: 'cacador', nome: 'Alojamento do Caçador', disponivel: false, custo: 3000, descricao: "Um alojamento rústico decorado com troféus, o ponto de partida para enfrentar as feras de Kuar-Tor.", acoes: [
                    { nome: 'Pegar um Contrato de Caça', desc: 'Aceite missões para caçar criaturas específicas.' },
                    { nome: 'Estudar Bestiário', desc: 'Ganhe bônus de conhecimento sobre uma criatura.' },
                    { nome: 'Preparar Armadilhas e Iscas', desc: 'Crie equipamentos para facilitar suas caçadas.' }
                ]},
                { id: 'laboratorio_anomalias', nome: 'Laboratório de Anomalias', disponivel: false, custo: 4000, descricao: "Um espaço contido onde artefatos paradoxais e entidades instáveis do Vazio são estudados sob estrita observação.", acoes: [
                    { nome: 'Analisar Artefato Paradoxal', desc: 'Tente entender a função de um item que desafia as leis da física.' },
                    { nome: 'Conter Entidade Instável', desc: 'Realize um ritual para estabilizar ou banir uma criatura capturada do Vazio.' },
                    { nome: 'Extrair Essência Anômala', desc: 'Destile a essência de um objeto anômalo para criar componentes únicos.' },
                    { nome: 'Consultar Registros de Incursão', desc: 'Estude relatórios de expedições que deram terrivelmente errado para aprender com os erros.' }
                ]},
                { id: 'casa_paz_prazeres', nome: 'Casa da Paz/Prazeres', disponivel: false, custo: 5000, descricao: "Um refúgio para a mente, onde a alma pode se recuperar ou se perder em prazeres controlados.", acoes: [
                    { nome: 'Recuperação Mental', desc: 'Recupere-se de traumas e penalidades de Sanidade.' },
                    { nome: 'Socializar e Obter Rumores', desc: 'Obtenha informações valiosas, missões e aliados.' },
                    { nome: 'Participar de um Jogo de Azar', desc: 'Aposte seus Fragmentos em jogos de sorte e estratégia.' },
                    { nome: 'Buscar um Prazer Específico', desc: 'Encomende uma experiência customizada com a Condessa Eveline.' }
                ]}
            ]
        };

        // --- ELEMENTOS DO DOM ---
        const comodosGrid = document.getElementById('comodos-grid');
        const logContainer = document.getElementById('log-container');
        const modal = document.getElementById('modal-acoes');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const adminLoginButton = document.getElementById('admin-login-button');
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const passwordError = document.getElementById('passwordError');
        const cancelPasswordButton = document.getElementById('cancelPasswordButton');
        const submitPasswordButton = document.getElementById('submitPasswordButton');

        // --- ESTADO DO JOGO ---
        let isAdminMode = false;
        const ADMIN_PASSWORD = 'fungus'; // Senha para o modo admin

        // --- FUNÇÕES ---

        /** Ativa ou desativa o modo de administrador */
        function setAdminMode(isAdmin) {
            isAdminMode = isAdmin;
            renderizarComodos(); // Re-renderiza os cômodos com ou sem os controles de admin
        }

        adminLoginButton.addEventListener('click', () => {
            if (isAdminMode) {
                setAdminMode(false);
                adicionarLog("Modo de administrador desativado.", "info");
            } else {
                passwordModal.classList.remove('hidden');
            }
        });

        cancelPasswordButton.addEventListener('click', () => {
            passwordModal.classList.add('hidden');
        });

        submitPasswordButton.addEventListener('click', () => {
            if (passwordInput.value === ADMIN_PASSWORD) {
                setAdminMode(true);
                passwordModal.classList.add('hidden');
                passwordInput.value = '';
                adicionarLog("Modo de administrador ativado.", "sucesso");
            } else {
                passwordError.classList.remove('hidden');
                setTimeout(() => passwordError.classList.add('hidden'), 3000);
            }
        });

        /** Adiciona uma mensagem ao registro de atividades */
        function adicionarLog(mensagem, tipo = 'info') {
            const cores = {
                info: 'text-gray-400',
                sucesso: 'text-green-400',
                erro: 'text-red-400',
                aviso: 'text-yellow-400'
            };
            const p = document.createElement('p');
            p.className = `log-message ${cores[tipo]}`;
            p.textContent = `> ${mensagem}`;
            logContainer.appendChild(p);
            logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll
        }

        /** Renderiza todos os cômodos na tela */
        function renderizarComodos() {
            comodosGrid.innerHTML = ''; // Limpa o grid
            gameState.comodos.forEach(comodo => {
                const card = document.createElement('div');
                card.className = 'card rounded-lg p-6 flex flex-col h-full';
                
                let adminControls = '';
                if (isAdminMode) {
                    const btnClass = comodo.disponivel ? 'bg-red-600 hover:bg-red-500' : 'bg-green-600 hover:bg-green-500';
                    const btnText = comodo.disponivel ? 'Bloquear' : 'Liberar';
                    adminControls = `<button data-comodo-id="${comodo.id}" class="admin-btn mt-4 text-sm ${btnClass} text-white py-1 px-3 rounded">${btnText}</button>`;
                }

                if (comodo.disponivel) {
                    card.classList.add('cursor-pointer');
                    card.innerHTML = `
                        <h3 class="text-2xl font-cinzel text-violet-300 mb-2">${comodo.nome}</h3>
                        <p class="text-gray-400 flex-grow">${comodo.descricao}</p>
                        <div class="text-right mt-4 text-violet-400 font-semibold">Ver Ações</div>
                        ${adminControls}
                    `;
                    card.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('admin-btn')) {
                            abrirModalAcoes(comodo)
                        }
                    });
                } else {
                    card.classList.add('card-locked');
                    card.innerHTML = `
                        <div class="card-content flex flex-col h-full items-center justify-center text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                            <h3 class="text-2xl font-cinzel text-gray-500 mb-2">${comodo.nome}</h3>
                            <p class="text-gray-400 mb-2">Bloqueado</p>
                            <p class="text-gray-400 text-sm">Custo: ${comodo.custo}</p>
                            ${adminControls}
                        </div>
                    `;
                }
                comodosGrid.appendChild(card);
            });
        }

        /** Abre e popula o modal de ações */
        function abrirModalAcoes(comodo) {
            modalTitle.textContent = comodo.nome;
            modalBody.innerHTML = '';
            
            const acoesHtml = comodo.acoes.map(acao => `
                <div class="mb-4 p-4 bg-gray-800/50 rounded-lg border border-gray-700">
                    <h4 class="text-lg font-bold text-violet-300">${acao.nome}</h4>
                    <p class="text-gray-400">${acao.desc}</p>
                    <button class="mt-2 text-sm bg-violet-700 hover:bg-violet-600 text-white py-1 px-3 rounded" onclick="realizarAcao('${comodo.nome}', '${acao.nome}')">Realizar</button>
                </div>
            `).join('');
            
            modalBody.innerHTML = acoesHtml;
            modal.classList.remove('hidden');
        }

        /** Fecha o modal de ações */
        function fecharModal() {
            modal.classList.add('hidden');
        }
        
        /** Simula a realização de uma ação e a registra no log */
        function realizarAcao(nomeComodo, nomeAcao) {
            adicionarLog(`Ação "${nomeAcao}" iniciada em "${nomeComodo}".`, 'aviso');
            // Aqui iria a lógica de teste de perícia, gasto de recursos, etc.
            // Por enquanto, apenas simulamos um resultado.
            setTimeout(() => {
                 adicionarLog(`Resultado de "${nomeAcao}"... (Simulação)`, 'info');
            }, 1000);
            fecharModal();
        }

        /** Alterna a disponibilidade de um cômodo */
        function toggleDisponibilidade(comodoId) {
            const comodo = gameState.comodos.find(c => c.id === comodoId);
            if (comodo) {
                comodo.disponivel = !comodo.disponivel;
                saveComodoState(comodoId, comodo.disponivel);
                renderizarComodos();
                const status = comodo.disponivel ? "liberado" : "bloqueado";
                adicionarLog(`O cômodo "${comodo.nome}" foi ${status}.`, "sucesso");
            }
        }

        /** Salva o estado de um cômodo no Firebase */
        function saveComodoState(comodoId, disponivel) {
            database.ref('nexo/comodos/' + comodoId).set(disponivel);
        }

        /** Carrega o estado dos cômodos do Firebase */
        function loadComodosState() {
            database.ref('nexo/comodos').once('value', (snapshot) => {
                const comodosState = snapshot.val();
                if (comodosState) {
                    gameState.comodos.forEach(comodo => {
                        if (comodosState[comodo.id] !== undefined) {
                            comodo.disponivel = comodosState[comodo.id];
                        }
                    });
                }
                renderizarComodos();
            });
        }

        // --- INICIALIZAÇÃO ---
        auth.onAuthStateChanged(user => {
            if (user) {
                init();
            } else {
                // Redireciona para a página de login se não estiver logado
                window.location.href = 'login.html';
            }
        });

        function init() {
            loadComodosState();
            
            // Event Listeners do Modal
            modalCloseBtn.addEventListener('click', fecharModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    fecharModal();
                }
            });

            comodosGrid.addEventListener('click', (e) => {
                if (e.target.classList.contains('admin-btn')) {
                    const comodoId = e.target.dataset.comodoId;
                    toggleDisponibilidade(comodoId);
                }
            });
        }

    </script>
</body>
</html>